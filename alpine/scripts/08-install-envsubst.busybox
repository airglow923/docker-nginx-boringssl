#!/usr/bin/env sh

set -eu

apk add --no-cache --virtual .gettext gettext

mv /usr/bin/envsubst /tmp

ENVSUBST_DEPENDENCIES="$(
    scanelf --needed --nobanner /tmp/envsubst |
        awk '{ gsub(/,/, "\nso:", $2); print "so:" $2 }' |
        sort -u |
        xargs -r apk info --installed |
        sort -u
)"

apk add --no-cache $ENVSUBST_DEPENDENCIES

apk del .gettext

mv /tmp/envsubst /usr/local/bin
